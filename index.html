<!DOCTYPE html>
<html>
	
	<head>
		
		<title>The Factory</title>
		
		<meta charset="utf-8">
		
		<style>
			
			body {
				margin: 0px;
				margin-bottom: 0px;
			}
			
			canvas {
				padding: 0px;
			}
			
		</style>
		
	</head>
	
	<body>
		
		<canvas id="ctx" width="700" height="500"></canvas>
		
		<script>

			function unloadScrollBars() {
				document.documentElement.style.overflow = 'hidden';  // firefox, chrome
				document.body.scroll = "no"; // ie only
			}
			
			unloadScrollBars();
			
			//Setting up canvas for editing
			var canvas = document.getElementById("ctx");
			var c = canvas.getContext("2d");
			//Current frame
			var cFrame = 0;
			//Array to handle keyboard events
			var keys = [];
			//Current scene of the game as opposed to menu, help screen, etc
			var scene = "game";


			//Array to handle multiple sounds at once
			var sounds = [];

			//Useful functions
			{
				//Define a random function
				function random(min, max) {
					var w = max-min;
					return Math.random()*w+min;	
				}

				//Function for checking if object a is colliding with object b if and when objects a and b are anchored to the top right corner.
				function rectCollide(a, b) {
					return a.x+a.width > b.x && a.y+a.height > b.y && a.x < b.x+b.width && a.y < b.y+b.height;    
				}

				//Function for checking if object a is colliding with object b if and when object a is anchored to the top right corner, and object b is anchored to the center of itself.
				function cornerCenter(a, b) {
					return a.x+a.width > b.x-b.width/2 && a.y+a.height > b.y-b.height/2 && a.x < b.x+b.width/2 && a.y < b.y+b.height/2;
				}

				//Function for drawing triangles.
				function triangle(x1, y1, x2, y2, x3, y3) {
					c.beginPath();
					c.moveTo(x1, y1);
					c.lineTo(x2, y2);
					c.lineTo(x3, y3);
					c.fill();
				}

				function dist(x1, y1, x2, y2) {
					return Math.sqrt( Math.pow((x1-x2), 2) + Math.pow((y1-y2), 2) );
				}
			}
			
			var Block = function (x, y, width, height, type) {
				this.x = x;
				this.y = y;
				this.width = width;
				this.height = height;
				this.type = type;
			};

			Block.prototype.draw = function (){
				switch(this.type) {
					case "n":
						c.fillStyle = "rgb(10, 10, 10)";
						c.fillRect(this.x, this.y, this.width, this.height);
						break;
				}
			};


			var level = 0;
			var levels = [
				[
					"............................",
					".                          .",
					".                          .",
					".                          .",
					".                          .",
					".                          .",
					".                          .",
					".                          .",
					".                          .",
					".                          .",
					".                          .",
					".                          .",
					".                          .",
					".                          .",
					".                          .",
					"............................"
				]
			];
			var blocks = [];

			for (var i = 0 ; i < levels.length ; i++) {
				//Adds empty arrays to arrays filled with entities to seperate entities by level.
				blocks.push([]);
				//Loop through the rows of the strings.
				for (var t = 0 ; t < levels[i].length ; t++) {
					//Loop through the individual characters in the strings.
					for (var j = 0 ; j < levels[i][t].length ; j++) {
						//A switch statement based off the character of the current string.
						switch(levels[i][t][j]) {
							case ".":
								blocks[i].push(new Block(j*30, t*30, 31, 31, "n"));
								break;
						}
					}   
				}
			}
			
			//Insert player code
			var Player = function() {
				this.x = 50;
				this.y = 50;
				this.width = 20;
				this.height = 20;

				this.velX = 0;
				this.velY = 0;
				this.falling = true;
			};

			Player.prototype.draw = function() {
				c.fillStyle = "#000000"
				c.fillRect(this.x, this.y, this.width, this.height);
			}

			Player.prototype.update = function() {

				if (keys["ArrowLeft"]) {
					this.velX -= 0.5;
				}

				if (keys["ArrowRight"]) {
					this.velX+=0.5;
				}

				if (keys["ArrowUp"] && !this.falling) {
					this.velY-=8;
				}
				this.falling = true;

				this.velY+=0.3;

				this.x+=this.velX;
				this.collide(this.velX, 0);
				this.y+=this.velY;
				this.collide(0, this.velY);

				this.velX /= 1.1;

			}

			Player.prototype.collide = function(velX, velY) {
				for (var i = 0 ; i < blocks[level].length ; i++) {
					if (rectCollide(this, blocks[level][i]) && (blocks[level][i].type === "n")) {
						if (velX > 0) {
							this.velX = 0;
							this.x = blocks[level][i].x-this.width;
						}
						if (velX < 0) {
							this.velX = 0;
							this.x = blocks[level][i].x+blocks[level][i].width;
						}
						if (velY > 0) {
							this.velY = 0;
							this.y = blocks[level][i].y-this.height;
							this.falling = false;
						}
						if (velY < 0) {
							this.velY = 0;
							this.y = blocks[level][i].y+blocks[level][i].height;
							this.falling = true;
						}
						continue;
					}
				}
			}

			
			var bob = new Player();

			//To prevent cluttering of the draw function, game handling will go here.
			var Game = function() {
				//Variables for the game


			};

			Game.prototype.interact = function() {
				//Handling the game

				c.fillStyle = "#ffffff";
				c.fillRect(0, 0, 700, 500);

				for (var i = 0 ; i < blocks[level].length ; i++) {
					blocks[level][i].draw();
				}

				bob.draw();
				bob.update();

			}

			//Initializing a new instance of the game object
			var game = new Game();

			//Initialize the draw function
			function init() {
				window.requestAnimationFrame(draw);
			}

			//Running the init code
			init();

			//Draw function
			function draw() {
				switch(scene) {
					case "game":
						game.interact();
				}
				//Up the frame, every frame
				cFrame++;
				window.requestAnimationFrame(draw);
			}

			//Handle key events.
			window.addEventListener("keydown", function(e) {
				keys[e.key] = true;
				e.preventDefault();
			});

			window.addEventListener("keyup", function(e) {
				keys[e.key] = false;
				e.preventDefault();
			});

			
		</script>
		
	</body>
	
</html>